####################################
# 全局设置
####################################  
ipv6: false
http_port: 3080
socks_port: 3090
allow_external_connections: true
vif_only: false
hide_vpn_icon: false

geoip_db_url: https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb
asn_db_url: https://raw.githubusercontent.com/Loyalsoldier/geoip/release/GeoLite2-ASN.mmdb

proxy_latency_test_url: http://cp.cloudflare.com/generate_204
direct_latency_test_url: http://taobao.com/

compat_route: false
include_all_networks: false
include_apns: false
include_cellular_services: false
include_local_networks: false

####################################
# DNS
####################################

dns:
  bootstrap:
    - system
    - 233.5.5.5
    - 119.29.29.29
  upstreams:
      CN-DNS:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
      Foreign-DNS:
    - https://dns.cloudflare.com/dns-query
    - https://dns.google/dns-query
  forward:
    - proxy_rule_set:
      match: https://github.com/blackmatrix7/ios_rule_script/raw/refs/heads/master/rule/Surge/China/China_All.list
      value: CN-DNS
      disabled: false
    - proxy_rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Global/Global_All.list
      value: Foreign-DNS
      disabled: false
    - wildcard:
      match: '*'
      value: Foreign-DNS
      disabled: false
  hosts:
    iosapps.itunes.apple.com:
      - iosapps.itunes.apple.com.download.ks-cdn.com
  public_ip_lookup_url: https://ifconfig.me/ip

####################################
# Real IP（避免 Fake-IP）
####################################

real_ip_domains:
  - '*.weixin.qq.com'
  - mp.weixin.qq.com
  - szextshort.weixin.qq.com

####################################
# 策略组（仅美国 · 手动选择）
####################################

policy_groups:

  # 你的美国节点池（手动维护）
  - select:
      name: US-NODES
      policies:
        - US-Node-1
        - US-Node-2
        - US-Node-3
      icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/US.png

  - select:
      name: 国内直连
      policies:
        - DIRECT
      flatten: true
      hidden: true

  - select:
      name: 广告拦截
      policies:
        - REJECT
      flatten: true
      hidden: true

  - select:
      name: Apple
      policies:
        - DIRECT
      flatten: true
      icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/Apple.png

  ####################################
  # 应用分流（全部手动选 US 节点）
  ####################################

  - select:
      name: Telegram
      policies:
        - US-NODES
      icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/Telegram.png

  - select:
      name: Facebook
      policies:
        - US-NODES
      icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/FI.png

  - select:
      name: Instagram
      policies:
        - US-NODES
      icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/IN.png

  - select:
      name: Twitter
      policies:
        - US-NODES
      icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/Twitter.png
    
  - select:
      name: TikTok
      policies:
        - US-NODES
      icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/TikTok.png

  - select:
      name: Google
      policies:
        - US-NODES
      icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/Google.png

  - select:
      name: Ai
      policies:
        - US-NODES
      icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/CCCAT_C.png

  - select:
      name: Microsoft
      policies:
        - US-NODES
      icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/Windows.png

  ####################################
  # Final 兜底（美国）
  ####################################

  - select:
      name: Final兜底
      policies:
        - US-NODES
      icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/mini/Trojan_Letter.png

####################################
# 规则（Rules）——保持原逻辑
####################################
rules:

  # ——— 白名单放行资源，避免错拦元素 ———
  - domain:
      match: static.cloudflareinsights.com
      policy: DIRECT

  - domain_suffix:
      match: whatsapp.net
      policy: DIRECT

  - domain_suffix:
      match: whatsapp.com
      policy: DIRECT

  - domain_suffix:
      match: fbcdn.net
      policy: DIRECT

  - rule_set:
      name: reject
      match: https://raw.githubusercontent.com/GMOogway/shadowrocket-rules/master/sr_reject_list.module
      policy: REJECT
      update_interval: 86400

  - rule_set:
      name: Telegram
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Telegram/Telegram.list
      policy: Telegram
      update_interval: 86400
      
  - rule_set:
      name: Facebook
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Facebook/Facebook.list
      policy: Facebook
      update_interval: 86400
      
  - rule_set:
      name: Instagram 
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Instagram/Instagram.list
      policy: Instagram
      update_interval: 86400
      
  - rule_set:
      name: Twitter
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Twitter/Twitter.list
      policy: Twitter
      update_interval: 86400

  - rule_set:
      name: Google
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Google/Google.list
      policy: Google
      update_interval: 86400
      
  - rule_set:
      name: Microsoft
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Microsoft/Microsoft.list
      policy: Microsoft
      update_interval: 86400

  - rule_set:
      name: Ai
      match: https://raw.githubusercontent.com/Repcz/Tool/X/Egern/Rules/AI.yaml
      policy: Ai
      update_interval: 86400

  - rule_set:
      name: Apple.All
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Apple/Apple_All.list
      policy: Apple
      update_interval: 86400

  - geoip:
      match: CN
      policy: DIRECT

  - domain_suffix:
      match: cn
      policy: DIRECT

  - rule_set:
      name: proxy
      match: https://raw.githubusercontent.com/GMOogway/shadowrocket-rules/master/sr_proxy_list.module
      policy: Final兜底
      update_interval: 86400

  - default:
      policy: Final兜底

####################################
# 重写 / 脚本 / MitM
####################################

url_rewrites:
  - match: ^https?://(.*?L[.])?(?:glgoogle).cn
    location: https://$1google.com
    status_code: 302
    disabled: true
    
mitm:
  enabled: true
  ca_p12: egern.p12
  ca_passphrase: egern
  hostnames:
    includes:
      - kelee.one

####################################
# 模块（Modules）
####################################

modules:
  - name: sub-store配置同步
    url: https://raw.githubusercontent.com/QingRex/LoonKissSurge/main/Surge/Official/Sub-Store.official.sgmodule
    enabled: true

  - name: 流媒体解锁检测
    url: https://raw.githubusercontent.com/QingRex/LoonKissSurge/main/Surge/Official/流媒体解锁检测.official.sgmodule
    enabled: true

  - name: Google搜索重定向
    url: https://raw.githubusercontent.com/QingRex/LoonKissSurge/main/Surge/Google重定向.sgmodule
    enabled: true

